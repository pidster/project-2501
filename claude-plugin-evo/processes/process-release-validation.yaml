# Phase 7 Process: Release Validation
# AI-Led process - AI validates deployment, humans approve go-live
---
references:
  rules: ../rules/phase7-deployment.md

definition:
  id: "PROC-7.2"
  name: "Release Validation"
  description: |
    Validate deployed release in target environment.
    This is an AI-Led process where AI can execute validation
    checks while humans make go-live decisions.

    Supports two modes:
    - QUICK: Smoke tests and health checks (~15 min)
    - FULL: Comprehensive post-deployment validation (~1 hour)
  version: "1.0.0"
  phase: 7
  information_composition:
    formal: 55
    tacit: 30
    emergent: 15

interfaces:
  inputs:
    - type: "deployment_package"
      required: true
      description: "Deployed artifacts from PROC-7.1"
    - type: "deployment_runbook"
      required: true
      description: "Deployment instructions"
    - type: "rollback_plan"
      required: true
      description: "Recovery procedures"
    - type: "mode"
      required: false
      description: "QUICK or FULL (default: QUICK)"
  outputs:
    - type: "validation_results"
      description: "Post-deployment test results"
    - type: "go_live_decision"
      description: "Decision to proceed or rollback"
    - type: "release_notes"
      description: "Documentation of what was released"

steps:
  # Step 1: Execute deployment (AI-Led)
  - id: "7.2.1"
    name: "Execute Deployment"
    capability: Transform
    pattern: AI-Led
    human_role: "Monitor deployment progress"
    ai_role: "Execute runbook steps; track progress; report status"
    escalation_triggers:
      - condition: "Deployment step fails"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Deployment failed at step [X]. Retry, skip, or rollback?"
      - condition: "Unexpected behaviour during deployment"
        action: ESCALATE
        severity: MEDIUM
        target: human
        context: "Unexpected: [observation]. Continue or pause?"
    completion_criteria: "Deployment executed"
    validation: "All runbook steps completed"

  # Step 2: Run smoke tests (AI-Only)
  - id: "7.2.2"
    name: "Run Smoke Tests"
    capability: Validate
    pattern: AI-Only
    human_role: "None"
    ai_role: "Execute smoke test suite; verify basic functionality"
    escalation_triggers:
      - condition: "Smoke test failures"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Smoke tests failing. Rollback recommended. Proceed?"
    completion_criteria: "Smoke tests executed"
    validation: "Core functionality operational"

  # Step 3: Verify integration points (AI-Led)
  - id: "7.2.3"
    name: "Verify Integrations"
    capability: Validate
    pattern: AI-Led
    human_role: "Confirm critical integrations operational"
    ai_role: "Check external connections; verify data flows; test APIs"
    escalation_triggers:
      - condition: "Integration failure"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Integration with [system] failing. Impact assessment needed."
    completion_criteria: "Integrations verified"
    validation: "All integration points operational"

  # Step 4: Check monitoring and alerts (AI-Led)
  - id: "7.2.4"
    name: "Check Monitoring"
    capability: Validate
    pattern: AI-Led
    human_role: "Verify monitoring is appropriate"
    ai_role: "Confirm metrics flowing; verify alerts configured; check dashboards"
    escalation_triggers:
      - condition: "Monitoring not working"
        action: ESCALATE
        severity: MEDIUM
        target: human
        context: "Cannot confirm monitoring operational. Accept blind spot?"
    completion_criteria: "Monitoring verified"
    validation: "Monitoring and alerting active"

  # Step 5: Make go-live decision (Human-Led)
  - id: "7.2.5"
    name: "Go-Live Decision"
    capability: Decide
    pattern: Human-Led
    human_role: "Decide whether to proceed with release"
    ai_role: "Present validation summary; recommend action; record decision"
    escalation_triggers:
      - condition: "Partial failures present"
        action: ESCALATE
        severity: MEDIUM
        target: human
        context: "Some validations failed. Accept risk or rollback?"
    completion_criteria: "Go-live decision made"
    validation: "Decision documented"

  # Step 6: Publish release notes (AI-Led)
  - id: "7.2.6"
    name: "Publish Release Notes"
    capability: Preserve
    pattern: AI-Led
    human_role: "Approve release communication"
    ai_role: "Generate release notes; notify stakeholders; update documentation"
    escalation_triggers:
      - condition: "Communication blocked"
        action: ESCALATE
        severity: LOW
        target: human
        context: "Cannot send notifications. Proceed manually?"
    completion_criteria: "Release notes published"
    validation: "Stakeholders notified"

control_flow:
  retry_policy:
    on_validation_failure:
      return_to: "7.2.2"
      max_iterations: 2
  mode_variations:
    QUICK:
      skip_steps: []
      time_budget_minutes: 15
      depth: "Smoke tests and health checks"
    FULL:
      skip_steps: []
      time_budget_minutes: 60
      depth: "Comprehensive validation"

quality:
  entry_criteria:
    - "Deployment package deployed"
    - "Rollback plan available"
  exit_criteria:
    - "Validation complete"
    - "Go-live decision made"
  sla:
    expected_duration_minutes: 15
    timeout_minutes: 90
    warning_threshold_percent: 80

progressive_disclosure:
  initial_mode: QUICK
  upgrade_triggers:
    - "Production environment"
    - "Customer-facing changes"
    - "Significant architectural changes"
    - "Human requests thorough validation"
  upgrade_prompt: |
    This release affects production functionality.
    Would you like to switch to FULL mode for comprehensive
    post-deployment validation before go-live?

flow: |
  ```mermaid
  flowchart TD
    subgraph Steps
      S1["7.2.1 Execute Deployment<br/>(Transform, AI-Led)"]
      S2["7.2.2 Run Smoke Tests<br/>(Validate, AI-Only)"]
      S3["7.2.3 Verify Integrations<br/>(Validate, AI-Led)"]
      S4["7.2.4 Check Monitoring<br/>(Validate, AI-Led)"]
      S5["7.2.5 Go-Live Decision<br/>(Decide, Human-Led)"]
      S6["7.2.6 Publish Release Notes<br/>(Preserve, AI-Led)"]
    end

    S1 --> S2
    S2 --> S3
    S3 --> S4
    S4 --> S5
    S5 --> S6

    S1 -->|"Failed"| ESC1[Escalate: retry/rollback?]
    S2 -->|"Failures"| ESC2[Escalate: rollback?]
    S3 -->|"Integration fail"| ESC3[Escalate: impact?]
    S5 -->|"Partial fail"| ESC4[Escalate: risk?]

    S6 --> OUT[Validation Results + Go-Live Decision]
  ```
---
