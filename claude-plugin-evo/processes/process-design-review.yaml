# Phase 4 Process: Design Review
# Human-Led process - humans validate, AI supports analysis
---
references:
  rules: ../rules/phase4-design.md

definition:
  id: "PROC-4.4"
  name: "Design Review"
  description: |
    Review and validate design artifacts before implementation.
    This is a human-led process where AI supports analysis while
    humans make approval decisions.

    Supports two modes:
    - QUICK: Lightweight review for low-risk designs (~30 min)
    - FULL: Formal review with multiple stakeholders (~2-3 hours)
  version: "1.0.0"
  phase: 4
  information_composition:
    formal: 50
    tacit: 30
    emergent: 20

interfaces:
  inputs:
    - type: "architecture_document"
      required: true
      description: "Output from PROC-4.1"
    - type: "interface_specifications"
      required: true
      description: "Output from PROC-4.2"
    - type: "data_model"
      required: true
      description: "Output from PROC-4.3"
    - type: "requirements_specification"
      required: true
      description: "For traceability validation"
    - type: "mode"
      required: false
      description: "QUICK or FULL (default: QUICK)"
  outputs:
    - type: "review_report"
      description: "Review findings, decisions, and approvals"
    - type: "design_baseline"
      description: "Approved design baseline for implementation"
    - type: "deferred_items"
      description: "Issues to address in implementation"

steps:
  # Step 1: Prepare review materials (AI-Led)
  - id: "4.4.1"
    name: "Prepare Materials"
    capability: Synthesise
    pattern: AI-Led
    human_role: "Confirm materials are complete for review"
    ai_role: "Compile design artifacts; create review summary; highlight key decisions"
    escalation_triggers:
      - condition: "Design artifacts incomplete"
        action: RETURN
        severity: HIGH
        target: "PROC-4.1"
        context: "Design incomplete for review. Which artifacts are missing?"
    completion_criteria: "Review materials prepared"
    validation: "All design artifacts available"

  # Step 2: Check consistency (AI-Led)
  - id: "4.4.2"
    name: "Check Consistency"
    capability: Validate
    pattern: AI-Led
    human_role: "Review flagged inconsistencies"
    ai_role: "Cross-check design artifacts for consistency; flag conflicts"
    escalation_triggers:
      - condition: "Design inconsistencies found"
        action: ESCALATE
        severity: MEDIUM
        target: human
        context: "Inconsistencies between design artifacts. Resolve before review?"
    completion_criteria: "Consistency check complete"
    validation: "No critical inconsistencies"

  # Step 3: Validate traceability (AI-Led)
  - id: "4.4.3"
    name: "Validate Traceability"
    capability: Validate
    pattern: AI-Led
    human_role: "Confirm requirement coverage is acceptable"
    ai_role: "Verify design traces to requirements; identify coverage gaps"
    escalation_triggers:
      - condition: "Requirements not addressed by design"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Design doesn't address all requirements. Update design or defer?"
    completion_criteria: "Traceability validated"
    validation: "All high-priority requirements traceable"

  # Step 4: Assess risks (Human-Led)
  - id: "4.4.4"
    name: "Assess Design Risks"
    capability: Analyse
    pattern: Human-Led
    human_role: "Evaluate design risks based on experience"
    ai_role: "Record and structure risk assessment; do not suggest risk levels"
    escalation_triggers:
      - condition: "High-risk design decision identified"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Significant design risk. Accept, mitigate, or redesign?"
    completion_criteria: "Design risks assessed"
    validation: "Risk assessment documented"

  # Step 5: Conduct review (Human-Led)
  - id: "4.4.5"
    name: "Conduct Review"
    capability: Validate
    pattern: Human-Led
    human_role: "Lead review discussion; make approval decision"
    ai_role: "Record findings and decisions; track action items"
    escalation_triggers:
      - condition: "Reviewer disagrees with design approach"
        action: ESCALATE
        severity: HIGH
        target: human
        context: "Design approach contested. Resolve or escalate to architecture authority?"
      - condition: "Review cannot reach consensus"
        action: DEFER
        severity: MEDIUM
        target: "4.4.6"
        context: "No consensus. Document dissent and escalate decision?"
    completion_criteria: "Review conducted"
    validation: "Review decision recorded"

  # Step 6: Finalise baseline (AI-Led)
  - id: "4.4.6"
    name: "Finalise Baseline"
    capability: Preserve
    pattern: AI-Led
    human_role: "Approve final baseline"
    ai_role: "Create design baseline; compile action items; document deferrals"
    escalation_triggers:
      - condition: "Baseline incomplete due to unresolved issues"
        action: ESCALATE
        severity: MEDIUM
        target: human
        context: "Issues remain unresolved. Partial baseline acceptable?"
    completion_criteria: "Design baseline created"
    validation: "Baseline approved for implementation"

control_flow:
  retry_policy:
    on_validation_failure:
      return_to: "4.4.4"
      max_iterations: 2
  mode_variations:
    QUICK:
      skip_steps: []
      time_budget_minutes: 30
      depth: "Lightweight review; key risks only"
    FULL:
      skip_steps: []
      time_budget_minutes: 150
      depth: "Formal review; comprehensive risk assessment"

quality:
  entry_criteria:
    - "All design artifacts completed"
    - "Reviewers identified and available"
  exit_criteria:
    - "Design reviewed and decision recorded"
    - "Baseline established (approved or conditionally approved)"
  sla:
    expected_duration_minutes: 30
    timeout_minutes: 180
    warning_threshold_percent: 80

progressive_disclosure:
  initial_mode: QUICK
  upgrade_triggers:
    - "Significant architectural changes from prior baseline"
    - "Multiple stakeholder groups affected"
    - "High-risk or novel design patterns"
    - "Human requests formal review"
  upgrade_prompt: |
    This design has elements that warrant formal review.
    Would you like to switch to FULL mode for comprehensive review
    with risk assessment and stakeholder sign-off?

flow: |
  ```mermaid
  flowchart TD
    subgraph Steps
      S1["4.4.1 Prepare Materials<br/>(Synthesise, AI-Led)"]
      S2["4.4.2 Check Consistency<br/>(Validate, AI-Led)"]
      S3["4.4.3 Validate Traceability<br/>(Validate, AI-Led)"]
      S4["4.4.4 Assess Risks<br/>(Analyse, Human-Led)"]
      S5["4.4.5 Conduct Review<br/>(Validate, Human-Led)"]
      S6["4.4.6 Finalise Baseline<br/>(Preserve, AI-Led)"]
    end

    S1 --> S2
    S2 --> S3
    S3 --> S4
    S4 --> S5
    S5 --> S6

    S1 -->|"Incomplete"| RET1[Return to PROC-4.1]
    S2 -->|"Inconsistencies"| ESC1[Escalate: resolve]
    S3 -->|"Gaps"| ESC2[Escalate: update design]
    S4 -->|"High risk"| ESC3[Escalate: accept/mitigate]
    S5 -->|"Contested"| ESC4[Escalate: architecture authority]
    S5 -->|"No consensus"| DEF[Defer to 4.4.6]

    S6 --> OUT[Review Report + Design Baseline]
  ```
---
